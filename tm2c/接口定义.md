# 接口定义

## 处理方法

```
# 元方法
visitItem(ast, context)

# 具体的方法
visitAssignment(ast, context)
```

## 上下文

```

push(ref, value)
pop() -> ref, vlaue

getTemp(value) -> tempRef
getTempSize() -> tempSize
restoreTempSize()

```

## 示例

```python
a = 1 + 2 + 3;

( = a (+ (+ 1 2) 3))

class Context:

	def putCode(self, codeLine):
		pass

	def push(self, ref, value):
		self.stack.append([ref, value])

	def pop(self, item):
		return self.stack.pop()

    def getTempSize(self):
	    pass

	def restoreTempSize(self, size):
		pass
		
	def getTemp(self, value):
		pass

	def freeTemp(self):
		pass

	def getCode(self):
		pass

def visitNumber(item, context):
	context.push(item.val, item.val)

def visitAdd(item, context):
    visitItem(item.first)
    visitItem(item.second)
    name2, v2 = context.pop()
    name1, v1 = context.pop()
    if name1 is None:
	    name1 = context.getTemp(self, v1)
	if name2 is None:
		name2 = context.getTemp(self, v2)
    context.push(None, "tmAdd(%s, %s)" % (name1,name2))

def visitAssignment(item, context):
	tempSize = context.getTempSize()
	visitItem(item.second, context)
	if item.type == "name":
		name, val = context.pop()
		context.push("%s=%s" % (item.val, val))
		context.restoreTempSize(tempSize)
	else:
		# handle set, multi-assignment, etc.
		pass

_handlers = {
    "number": visitNumber,
	"=" : visitAssignment,
	"+" : visitAdd
}

def visitItem0(item, context):
    handlers[item.type](item, context)

def visitItem(item, context):
    if istype(item, "list"):
        for item0 in item:
            visitItem(item0, context)
    else:
	    visitItem0(item, context)


number: push(1,1)
number: push(2,2)
add   : push(None, "tmAdd(1,2)")
number: push(3, 3)
add   : emit("t1=tmAdd(1,2)")
        push(None, "tmAdd(t1,3)")
assign: push("a=tmAdd(t1,3)")

```



